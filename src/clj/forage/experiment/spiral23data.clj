;; For processing xls/csv data generated by spiral23 into tech.ml.dataset
;; structures.
(ns forage.experiment.spiral23data
  (:require [utils.csv :as csv]
            [tech.v3.dataset :as ds]
            [tech.v3.datatype.functional :as dsf]
            [tablecloth.api :as tc]
            ;[forage.core.run :as fr]
            ;[utils.math :as um]
  ))

(def home (System/getenv "HOME"))
(def fileloc "/docs/src/data.foraging/forage/spiral23/")
(def filename "spiral23configs28runs4KdataFreshFromClojure.csv")
(def filepath (str home fileloc filename))

(comment

  (def rawcsv (csv/slurp-csv filepath))
  ;; PROBLEM: Numbers are treated as strings
  (count rawcsv)
  (count (first rawcsv))
  (take 14 (first rawcsv))
  (take 14 (second rawcsv))

  (def csv (map #(map csv/number-or-string %) rawcsv))

  (map #(take 14 %) (take 2 csv))

  (def headless (next csv))
  (def data-columns (map (partial drop 5) headless))

  (def runs-per-config (count (nth data-columns 0)))

  ;; first experiment:
  (def length-row (nth data-columns 0))
  (def found-row  (nth data-columns 1))
  (def walk (nth (nth headless 0) 1))
  (def env (nth (nth headless 0) 2))
  (def config0-ds (ds/->dataset {:length length-row
                                 :found  found-row
                                 :walk (repeat num-runs walk)
                                 :env (repeat num-runs env)}))

  (class config0-ds)

  (ds/descriptive-stats config0-ds 
                        {:stat-names [:col-name :datatype :min :mean :max :standard-deviation]})
  ;; _unnamed: descriptive-stats [4 6]:
  ;; 
  ;; | :col-name | :datatype |        :min |           :mean |      :max | :standard-deviation |
  ;; |-----------|-----------|------------:|----------------:|----------:|--------------------:|
  ;; |   :length |  :float64 | 2143.930733 | 969266.06787012 | 1000000.0 |     155112.05966146 |
  ;; |    :found |    :int64 |    0.000000 |      0.04375000 |       1.0 |          0.20456392 |
  ;; |     :walk |   :string |             |                 |           |                     |
  ;; |      :env |   :string |             |                 |           |                     |

)
